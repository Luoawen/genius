<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title></title>
    <script th:src="@{/js/location.js}" type="text/javascript"></script>
    <script th:src="@{/js/jquery-2.0.0.min.js}" type="text/javascript"></script>
    <script th:inline="javascript">


        var sec = 0;
        var minu = 0;
        var hou = 0;
        // 每隔一秒刷新一次
        window.setTimeout("uupdate()", 1000);

        function uupdate() {
            sec++;
            if(sec == 60) {
                sec = 0;
                minu += 1;
            }
            if(minu == 60) {
                minu = 0;
                hou += 1;
            }
            var ss04 = hou + "时" + minu + "分" + sec + "秒";
            document.getElementById('yy004').innerHTML = ss04;
            window.setTimeout("uupdate()", 1000);
        }

        function showtime() {
            var nowTime = new Date();//创建时间对象实例
            var hours = nowTime.getHours();//获取当前小时数
            var minutes = nowTime.getMinutes();//获取当前分钟数
            var seconds = nowTime.getSeconds();//获取当前秒数
            var timer = " "+((hours>12)?hours-12:hours);//将小时数质赋予变量timer
            timer +=((minutes<10)?"0:":":")+minutes;//将分钟数值赋予变量timer
            timer += ((seconds<10)?"0:":":")+seconds;//将秒数值赋予变量timer
            timer +=" "+((hours>12)?"pm":"am");//将字符am或pm赋予变量timer
            document.getElementById('clock').innerHTML = timer;
            setTimeout("showtime()",1000);
        }


        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var reg_rewrite = new RegExp("(^|/)" + name + "/([^/]*)(/|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            var q = window.location.pathname.substr(1).match(reg_rewrite);
            if(r != null){
                return unescape(r[2]);
            }else if(q != null){
                return unescape(q[2]);
            }else{
                return null;
            }
        }

        $(function () {
            var userId = [[${userId}]];
            var templateId = getQueryString("templateId");
            // alert('userId=' + userId + ',templateId' + templateId);

            var param = {
                'userId': userId,
                'templateId': templateId
            };
            $.ajax({
                type: 'post',
                url: "/wechat/share/code",
                contentType: "application/json",
                dataType: 'json',
                data: JSON.stringify(param),
                success: function (data) {
                    var content = data.data.content;
                    var jsonArr = JSON.parse(content);
                    var all = "";
                    jsonArr.forEach(function(currentValue, index, arr){
                        all = all + currentValue.content + "<br/>";
                    }, this)
                    $("#content").html(all);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("网络超时，请重试");
                }
            });

        });
    </script>
</head>
<body onload="showtime()">
<div>当前时间：<span id="clock"></span ></div>
<div>当前页面停留时间：<span id="yy004" >0时0分0秒</span></div>
<p th:text="'Hello, ' + ${userId} + '!'" />
<div id="content"></div>
</body>
</html>